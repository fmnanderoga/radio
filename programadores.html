<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel de Notificaciones</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Nunito', sans-serif;
    background: #f5f5f5;
    padding: 15px;
}
h1 {
    text-align: center;
    margin-bottom: 20px;
    color: #0f8f5a;
    font-size: 1.6rem;
}
.card-container {
    max-width: 600px;
    margin: auto;
    width: 100%;
}
.card {
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    background: #fff;
}
textarea, input[type="number"] {
    border-radius: 8px;
    font-size: 1rem;
}
#contador {
    font-weight: bold;
    font-size: 1.1rem;
    margin-top: 15px;
    color: #0f8f5a;
    text-align: center;
}
#status {
    text-align: center;
    margin-top: 10px;
    font-size: 1rem;
}
@media (max-width: 576px) {
    h1 { font-size: 1.3rem; }
    .card { padding: 15px; }
    textarea, input[type="number"] { font-size: 0.95rem; }
    .btn { width: 100%; margin-bottom: 8px; font-size: 0.95rem; padding: 10px; }
    #contador { font-size: 1rem; }
}
</style>
</head>
<body>

<h1>Panel de Notificaciones</h1>

<div class="card-container">
    <div class="card">
        <div class="mb-3">
            <label for="notificacionTexto" class="form-label">Texto de la notificación:</label>
            <textarea class="form-control" id="notificacionTexto" rows="3" placeholder="Escribe aquí tu mensaje..."></textarea>
        </div>

        <div class="mb-3">
            <label for="duracion" class="form-label">Duración (minutos):</label>
            <input type="number" id="duracion" class="form-control" min="1" value="10">
        </div>

        <div class="row g-2">
            <div class="col-12 col-sm-6">
                <button id="guardarBtn" class="btn btn-success w-100">Guardar</button>
            </div>
            <div class="col-12 col-sm-6">
                <button id="borrarBtn" class="btn btn-danger w-100">Borrar</button>
            </div>
        </div>

        <div id="status" class="mt-3"></div>
        <div id="contador"></div>
    </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCGve3UBqB95lpKC19HQOyiUq7WjZg22IA",
    authDomain: "fm-nanderoga-e3e68.firebaseapp.com",
    databaseURL: "https://fm-nanderoga-e3e68-default-rtdb.firebaseio.com",
    projectId: "fm-nanderoga-e3e68",
    storageBucket: "fm-nanderoga-e3e68.firebasestorage.app",
    messagingSenderId: "888936894327",
    appId: "1:888936894327:web:5e2d8c7c20188dbf391b72",
    measurementId: "G-6QW100YFH7"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
</script>

<script>
const guardarBtn = document.getElementById('guardarBtn');
const borrarBtn = document.getElementById('borrarBtn');
const notificacionTexto = document.getElementById('notificacionTexto');
const duracionInput = document.getElementById('duracion');
const statusEl = document.getElementById('status');
const contadorEl = document.getElementById('contador');

let timeoutId = null;
let intervalId = null;

// Cargar la notificación actual desde Firebase al abrir el panel
database.ref('notificacionActual').get().then(snapshot => {
    if(snapshot.exists()){
        notificacionTexto.value = snapshot.val();
    }
});

// Función para borrar notificación
function borrarNotificacion() {
    notificacionTexto.value = "";
    statusEl.textContent = "Notificación borrada";
    statusEl.className = "mt-3 text-warning";
    contadorEl.textContent = "";

    // Borrar en Firebase
    database.ref('notificacionActual').set("");

    if(timeoutId) clearTimeout(timeoutId);
    if(intervalId) clearInterval(intervalId);
}

// Función para iniciar cuenta atrás
function iniciarCuentaAtras(minutos) {
    let segundosRestantes = minutos * 60;
    actualizarContador(segundosRestantes);

    if(intervalId) clearInterval(intervalId);
    intervalId = setInterval(() => {
        segundosRestantes--;
        if(segundosRestantes <= 0){
            clearInterval(intervalId);
            contadorEl.textContent = "";
            return;
        }
        actualizarContador(segundosRestantes);
    }, 1000);
}

function actualizarContador(segundos) {
    const m = Math.floor(segundos/60);
    const s = ('0'+(segundos%60)).slice(-2);
    contadorEl.textContent = `Tiempo restante: ${m}:${s}`;
}

// Guardar la notificación en Firebase
guardarBtn.addEventListener('click', () => {
    const texto = notificacionTexto.value.trim();
    const minutos = parseInt(duracionInput.value);
    if(!texto || !minutos) return;

    database.ref('notificacionActual').set(texto)
        .then(() => {
            statusEl.textContent = "Notificación guardada";
            statusEl.className = "mt-3 text-success";

            if(timeoutId) clearTimeout(timeoutId);
            timeoutId = setTimeout(borrarNotificacion, minutos * 60 * 1000);

            iniciarCuentaAtras(minutos);
        })
        .catch(err => {
            statusEl.textContent = "Error al guardar: " + err;
            statusEl.className = "mt-3 text-danger";
        });
});

// Borrar la notificación manualmente
borrarBtn.addEventListener('click', borrarNotificacion);
</script>

</body>
</html>
